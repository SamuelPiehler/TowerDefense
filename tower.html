<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Skilltree</title>
    <script src="js/tower_Gegner_Stats.js"></script>
    <script src="js/skills.js"></script>
    <style>
    h1{
      color: red;
    }
    h2{
      color:#bcbbbf ;
    }
      body{
  /*background: radial-gradient(circle , #3DB7FF 20%, #FFFFFF 80%);*/
   background-image: url(Bilder/Hintergrund/Bild002.jpg);

        text-align: center;
      }
      .Skilltree{
        position: relative;
        margin-left: calc((100vw - (80px * 5))/15);
        margin-right: calc((100vw - (80px * 5))/15);
        margin-top: 5%;
        box-shadow: -5px -5px 5px blue , 5px 5px 5px blue , -5px 5px 5px white  , 5px -5px 5px white ;
        border-radius: 5%;
        background-color: gray;
      }
      #zurück{
        margin-right: calc(95vw - 21px);
      }
      #stats{
        background: linear-gradient(200deg,#6de3a2, #A36BFF );
        position: absolute;
        top: 30px;
        left: 30px;
        border: 10px;
        border-color: black;
        border-style: double;
        border-radius: 5px ;
      }
      #close{
        position: absolute;
        top: 0px;
        right: 0px;
      }
      #name{
        font-size: 2em;
      }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
  </head>
  <body>
    <div id="tree">
      <input id="zurück" type="button" value="zurück"> <br>
      <h1>Skilltree</h1>

      <h2>Klicke auf einen Turm um seine Werte zu sehen und zu verbessern. <br>
      Klicke auf das Fragezeichen um die Werte aller Türme zu verbessern. <br> <br></h2>
    </div>
    <div id="stats" hidden>
      <button type="button" id="close">x</button>
      <spwan name="Turmname" id="name"> </spwan><br>
      <table>
        <tr>
          <td>Damge  <spwan  name="Damge"></spwan></td>
          <td>
            <img src="Bilder/icons/plusAn.png" alt="">
            <img src="Bilder/icons/minusAn.png" alt="">
          </td>
        </tr>
        <tr>
          <td>critChance <spwan name="critChance"></spwan></td>
          <td>
            <img src="Bilder/icons/plusAn.png" alt="">
            <img src="Bilder/icons/minusAn.png" alt="">
          </td>
        </tr>
        <tr>
          <td>critDamage <spwan name="critDamage"></spwan></td>
          <td>
            <img src="Bilder/icons/plusAn.png" alt="">
            <img src="Bilder/icons/minusAn.png" alt="">
          </td>
        </tr>
        <tr>
          <td>Angriffszeit <spwan name="Angriffszeit"></spwan></td>
          <td>
            <img src="Bilder/icons/plusAn.png" alt="">
            <img src="Bilder/icons/minusAn.png" alt="">
          </td>
        </tr>
        <tr>
          <td>Reichweite <spwan name="Reichweite"></spwan></td>
          <td>
            <img src="Bilder/icons/plusAn.png" alt="">
            <img src="Bilder/icons/minusAn.png" alt="">
          </td>
        </tr>
        <tr id = "Drehgeschwindigkeit">
          <td>Drehgeschwindigkeit <spwan name="Drehgeschwindigkeit"></spwan></td>
          <td>
            <img src="Bilder/icons/plusAn.png" alt="">
            <img src="Bilder/icons/minusAn.png" alt="">
          </td>
        </tr>
        <tr id = "EffecktStärke">
          <td></td>
          <td>
            <img src="Bilder/icons/plusAn.png" alt="">
            <img src="Bilder/icons/minusAn.png" alt="">
          </td>
        </tr>
        <tr id = "EffecktDauer">
          <td></td>
          <td>
            <img src="Bilder/icons/plusAn.png" alt="">
            <img src="Bilder/icons/minusAn.png" alt="">
          </td>
        </tr>
        <tr id = "st5">
          <td>stufe5 unlockt <spwan name="Stufe5unlockt"></spwan></td>
          <td>
            <img src="Bilder/icons/plusAn.png" alt="">
            <img src="Bilder/icons/minusAn.png" alt="">
          </td>
        </tr>
        <tr id = "MaxStufe">
          <td>Maximale TurmStufe <spwan name="MaxStufe"></spwan></td>
          <td>
            <img src="Bilder/icons/plusAn.png" alt="">
            <img src="Bilder/icons/minusAn.png" alt="">
          </td>
        </tr>
      </table>
    </div>
    <script type="text/javascript">
    var skillPunkte = 0;
    var selected = -1;
    for (var i = 0; i < towertypen.length; i++) {
      if (i<10) {
        document.getElementById("tree").innerHTML += '<img id="0' + i + towertypen[i][10] + '" class="Skilltree" src="' + towertypen[i][1] + '">';
      }
      else {
        document.getElementById("tree").innerHTML += '<img id="' + i + towertypen[i][10] + '" class="Skilltree" src="' + towertypen[i][1] + '">';
      }
    }
    for (var i = 0; i < towertypen.length; i++) {
      if (i<10) {
        document.getElementById("0" + i + towertypen[i][10]).addEventListener("click", showStats);
      }
      else {
        document.getElementById(i + towertypen[i][10]).addEventListener("click", showStats);
      }
    }
    document.getElementById('close').addEventListener("click", close);
    for (var i = 0; i < document.getElementsByName("plus").length; i++) {
      neuerEventlistener(document.getElementsByName("plus")[i], addSkillpunkt, [i, true]);
      neuerEventlistener(document.getElementsByName("minus")[i], addSkillpunkt, [i, false]);
    }
    function neuerEventlistener(element, funktion, uebergabewerte) {
      element.addEventListener("click", function(){funktion(uebergabewerte);});
    }
    function close() {
      document.getElementById("stats").hidden = true;
    }
    function addSkillpunkt(uebergabewerte) {
      typ = uebergabewerte[0];
      plus = uebergabewerte[1];
      if (typ == 9) {
        var nummer = 123;
      }
      else {
        var nummer = typ + 10 * selected;
      }
      if (plus) {
        if (skills[nummer][9] < skills[nummer][8] && skillPunkte >= skills[nummer][10]+skills[nummer][9]) {
          var required = skills[nummer][7];   // sind genügend von benötigten skills geskillet
          for (var i = 0; i < skills[nummer][6].length; i++) {
            required -= skills[skills[nummer][6][i]][9];
          }
          if (required <= 0) {
            skillPunkte -= skills[nummer][10]+skills[nummer][9];
            skills[nummer][9]++;
          }
        }
      }
      else {
        if (skills[nummer][9] > 0) {
          //wenn dadurch requirements nichtmehr erfüllt sind prüfen
          var required = false;
          for (var i = 0; i < skills.length; i++) {
            if (skills[i] != undefined) {
              for (var j = 0; j < skills[i][6].length; j++) {
                if (skills[i][6][j] == nummer) {
                  var required2 = skills[i][7];
                  for (var k = 0; k < skills[i][6].length; k++) {
                    required2 -= skills[i][6][k][9];
                  }
                  if (required2 > 0) {
                    required = true;
                    break;
                  }
                }
              }
            }
          }
          if (!required) {
            skills[nummer][9]--;
            skillPunkte += skills[nummer][10]+skills[nummer][9];
          }
        }
      }
    }
    function showStats() {
      var pos = this.getBoundingClientRect();
      document.getElementById("stats").style.top = pos.y + 'px';
      document.getElementById("stats").style.left = pos.x + 70 + 'px';
      document.getElementById("stats").hidden = false;
      var towerTyp = this.id.substr(0,2)*1;
      selected = towerTyp;
      if (this.id.substr(2,6) == "Random") {
        document.getElementsByName("Turmname")[0].innerHTML="Stats für alle Türme";
        document.getElementsByName("Damge")[0].innerHTML="+"+(Math.pow(1+skills[110][4]/100, skills[110][9])-1)+"%";
        document.getElementsByName("critChance")[0].innerHTML="+"+(Math.pow(1+skills[114][4]/100, skills[114][9])-1)+"%";
        document.getElementsByName("critDamage")[0].innerHTML="+"+(Math.pow(1+skills[115][4]/100, skills[115][9])-1)+"%";
        document.getElementsByName("Angriffszeit")[0].innerHTML="-"+(1-Math.pow(1-skills[111][4]/100, skills[111][9]))+"%";
        document.getElementsByName("Reichweite")[0].innerHTML="+"+(Math.pow(1+skills[112][4]/100, skills[112][9])-1)+"%";
        document.getElementsByName("Drehgeschwindigkeit")[0].innerHTML="+"+(Math.pow(1+skills[113][4]/100, skills[113][9])-1)+"%";
        document.getElementById('EffecktStärke').hidden = false;
        document.getElementById('EffecktDauer').hidden = false;
        document.getElementById('EffecktStärke').childNodes[1].innerHTML = "EffecktStärke +"+(Math.pow(1+skills[116][4]/100, skills[116][9])-1)+"%";
        document.getElementById('EffecktDauer').childNodes[1].innerHTML = "EffektDauer/EffecktReichweite +"+(Math.pow(1+skills[117][4]/100, skills[117][9])-1)+"%";
        document.getElementById('st5').hidden = true;
        document.getElementById('MaxStufe').hidden = false;
        document.getElementsByName('MaxStufe')[0].innerHTML = skills[123][9]+3;
      }
      else {
        document.getElementsByName("Turmname")[0].innerHTML=towertypen[towerTyp][10];
        document.getElementsByName("Damge")[0].innerHTML=towertypen[towerTyp][2];
        document.getElementsByName("critChance")[0].innerHTML=towertypen[towerTyp][13]+"%";
        document.getElementsByName("critDamage")[0].innerHTML=towertypen[towerTyp][14]+"%";
        document.getElementsByName("Angriffszeit")[0].innerHTML=towertypen[towerTyp][5]+"sec";
        document.getElementsByName("Reichweite")[0].innerHTML=towertypen[towerTyp][4];
        document.getElementsByName("Drehgeschwindigkeit")[0].innerHTML=towertypen[towerTyp][3]*100+" Grad/sec";
        if (towertypen[towerTyp][7].length == 0) {
          document.getElementById('EffecktStärke').hidden = true;
          document.getElementById('EffecktDauer').hidden = true;
        }
        else {
          document.getElementById('EffecktStärke').hidden = false;
          document.getElementById('EffecktDauer').hidden = false;
          var obj = document.getElementById('EffecktStärke').childNodes[1];
          obj.innerHTML = "";
          for (var i = 0; i < towertypen[towerTyp][7].length; i++) {
            switch (towertypen[towerTyp][7][i]) {
              case 0:
                obj.innerHTML += "Verlangsamt Gegner auf die " + (1 / (towertypen[towerTyp][8][i] + 1)) + " fache Geschwindigkeit <br>";
                break;
              case 1:
                obj.innerHTML += "Stunned Gegner <br>";
                break;
              case 2:
                obj.innerHTML += "Verbrennt Gegner für " + towertypen[towerTyp][8][i] + " Schaden/sec <br>";
                break;
              case 3:
                obj.innerHTML += "Vergiftet Gegner für " + towertypen[towerTyp][8][i] + " Schaden/sec <br>";
                break;
              case 5:
                obj.innerHTML += "Trifft nahe Gegner zusätzlich für " + towertypen[towerTyp][8][i] + " Schaden <br>";
                break;
              case 6:
                obj.innerHTML += "Springt zusätzlich bis zu " + towertypen[towerTyp][8][i] + " mal auf nahe Gegner über <br>";
                break;
              case 7:
                obj.innerHTML += "Verbesstert den Damage von nahen Türmen um " + towertypen[towerTyp][8][i] + "% <br>";
                break;
              case 8:
                obj.innerHTML += "Oder: Verbesstert die Angriffsgeschwindigkeit von nahen Türmen um " + towertypen[towerTyp][8][i] + "% <br>";
                break;
              case 9:
                obj.innerHTML += "Oder: Verbesstert die Effektstärke, -dauer und -reichweite von nahen Türmen um " + towertypen[towerTyp][8][i] + "% <br>";
                break;
              case 10:
                obj.innerHTML += "Oder: Verbesstert die Drehgeschwindigkeit und Reichweite von nahen Türmen um " + towertypen[towerTyp][8][i] + "% <br>";
                break;
            }
          }
          obj = document.getElementById('EffecktDauer').childNodes[1];
          obj.innerHTML = "";
          if (towertypen[towerTyp][7].length > 1) {
            for (var i = 0; i < towertypen[towerTyp][7].length; i++) {
              if (towertypen[towerTyp][7][i] >= 5 && towertypen[towerTyp][7][i] <= 9) {
                obj.innerHTML += "Effektreichweite Effeckt " + (i+1) + ": " + towertypen[towerTyp][9][i] + " <br>";
              }
              else {
                obj.innerHTML += "Effektdauer: Effeckt " + (i+1) + ": " + towertypen[towerTyp][9][i] + "sec <br>";
              }
            }
          }
          else {
            if (towertypen[towerTyp][7][0] >= 5 && towertypen[towerTyp][7][0] <= 9) {
              obj.innerHTML += "Effektreichweite: " + towertypen[towerTyp][9][0] + " <br>";
            }
            else {
              obj.innerHTML += "Effektdauer: " + towertypen[towerTyp][9][0] + "sec <br>";
            }
          }
        }
        document.getElementById('st5').hidden = false;
        document.getElementById('MaxStufe').hidden = true;
        document.getElementsByName("Stufe5unlockt")[0].innerHTML=towertypen[towerTyp][12];
      }
    }
    </script>
  </body>
</html>
