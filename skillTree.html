<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Skilltree</title>
    <script src="js\importantFunktions.js"></script>
    <script src="js/tower_Gegner_Stats.js"></script>
    <script src="js/skills.js"></script>
    <style>
    h1{
      color: red;
    }
    h2{
      color:#bcbbbf ;
    }
    h3{
      color: gray ;
    }
      body{
        /*background: radial-gradient(circle , #3DB7FF 20%, #FFFFFF 80%);*/
         background-image: url(Bilder/Hintergrund/Bild002.jpg);
        text-align: center;
      }
      .Skilltree{
        position: relative;
        margin-left: calc((100vw - (80px * 5))/15);
        margin-right: calc((100vw - (80px * 5))/15);
        margin-top: 5%;
        box-shadow: -5px -5px 5px blue , 5px 5px 5px blue , -5px 5px 5px white  , 5px -5px 5px white ;
        border-radius: 5%;
        background-color: gray;
      }
      #zurück{
        margin-right: calc(95vw - 21px);
        box-shadow: 3px 2px 3px  #4fd78d, -3px -2px 3px #4fd78d, -3px 2px 3px  #4fd78d, 3px -2px 3px #4fd78d;
        border-radius: 20%;
      }
      #zurück:hover{
        content: url("Bilder/Buttons/backHover.png");
      }
      #stats{
        background: linear-gradient(200deg,#6de3a2, #A36BFF );
        position: absolute;
        top: 30px;
        left: 30px;
        border: 10px;
        border-color: black;
        border-style: double;
        border-radius: 5px ;
      }
      #close{
        position: absolute;
        top: 0px;
        right: 0px;
      }
      #name{
        font-size: 2em;
      }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
  </head>
  <body>
    <input type="Button" name="Reset " value="">
    <div id="tree">
      <a href="index.html"><img id="zurück" src="Bilder/Buttons/back.png" alt=""></a><br>
      <h1>Skilltree</h1> <br>
      <h2>Du hast 100 skillpunkte</h2> <br>
      <h3>Klicke auf einen Turm um seine Werte zu sehen und zu verbessern. <br>
      Klicke auf das Fragezeichen um die Werte aller Türme zu verbessern. <br> <br></h3>
    </div>
    <div id="stats" hidden>
      <img id="close" src="Bilder/icons/close.png" alt="">
      <font name="Turmname" id="name"> </font><br>
      <table>
        <tr>
          <td>Damge  <font  name="Damge"></font></td>
          <td name="buttons">
            <img src="Bilder/icons/plusAn.png" name="plus">
            <img src="Bilder/icons/minusAn.png" name="minus">
          </td>
        </tr>
        <tr>
          <td>Angriffszeit <font name="Angriffszeit"></font></td>
          <td name="buttons">
            <img src="Bilder/icons/plusAn.png" name="plus">
            <img src="Bilder/icons/minusAn.png" name="minus">
          </td>
        </tr>
        <tr>
          <td>Reichweite <font name="Reichweite"></font></td>
          <td name="buttons">
            <img src="Bilder/icons/plusAn.png" name="plus">
            <img src="Bilder/icons/minusAn.png" name="minus">
          </td>
        </tr>
        <tr id = "Drehgeschwindigkeit">
          <td>Drehgeschwindigkeit <font name="Drehgeschwindigkeit"></font></td>
          <td name="buttons">
            <img src="Bilder/icons/plusAn.png" name="plus">
            <img src="Bilder/icons/minusAn.png" name="minus">
          </td>
        </tr>
        <tr>
          <td>critChance <font name="critChance"></font></td>
          <td name="buttons">
            <img src="Bilder/icons/plusAn.png" name="plus">
            <img src="Bilder/icons/minusAn.png" name="minus">
          </td>
        </tr>
        <tr>
          <td>critDamage <font name="critDamage"></font></td>
          <td name="buttons">
            <img src="Bilder/icons/plusAn.png" name="plus">
            <img src="Bilder/icons/minusAn.png" name="minus">
          </td>
        </tr>
        <tr id = "EffecktStärke">
          <td></td>
          <td name="buttons">
            <img src="Bilder/icons/plusAn.png" name="plus">
            <img src="Bilder/icons/minusAn.png" name="minus">
          </td>
        </tr>
        <tr id = "EffecktDauer">
          <td></td>
          <td name="buttons">
            <img src="Bilder/icons/plusAn.png" name="plus">
            <img src="Bilder/icons/minusAn.png" name="minus">
          </td>
        </tr>
        <tr id = "st5">
          <td>stufe5 unlockt <font name="Stufe5unlockt"></font></td>
          <td name="buttons">
            <img src="Bilder/icons/plusAn.png" name="plus">
            <img src="Bilder/icons/minusAn.png" name="minus">
          </td>
        </tr>
        <tr id = "MaxStufe">
          <td>Maximale TurmStufe <font name="MaxStufe"></font></td>
          <td name="buttons">
            <img src="Bilder/icons/plusAn.png" name="plus">
            <img src="Bilder/icons/minusAn.png" name="minus">
          </td>
        </tr>
      </table>
    </div>
    <script type="text/javascript">
    var selected = -1;
    for (var i = 0; i < towertypen.length; i++) {
      if (i<10) {
        document.getElementById("tree").innerHTML += '<img id="0' + i + towertypen[i][10] + '" class="Skilltree" src="' + towertypen[i][1] + '">';
      }
      else {
        document.getElementById("tree").innerHTML += '<img id="' + i + towertypen[i][10] + '" class="Skilltree" src="' + towertypen[i][1] + '">';
      }
    }
    for (var i = 0; i < towertypen.length; i++) {
      if (i<10) {
        document.getElementById("0" + i + towertypen[i][10]).addEventListener("click", showStats);
      }
      else {
        document.getElementById(i + towertypen[i][10]).addEventListener("click", showStats);
      }
    }
    document.getElementById('close').addEventListener("click", close);
    for (var i = 0; i < document.getElementsByName("plus").length; i++) {
      neuerEventlistener(document.getElementsByName("plus")[i], addSkillpunkt, [i, true]);
      neuerEventlistener(document.getElementsByName("minus")[i], addSkillpunkt, [i, false]);
    }
    function neuerEventlistener(element, funktion, uebergabewerte) {
      element.addEventListener("click", function(){funktion(uebergabewerte, element);});
    }
    function close() {
      document.getElementById("stats").hidden = true;
    }
    function addSkillpunkt(uebergabewerte, element) {
      typ = uebergabewerte[0];
      plus = uebergabewerte[1];
      if (typ == 9) {
        var nummer = 123;
      }
      else {
        var nummer = typ + 10 * selected;
      }
      if (plus) {
        if (skills[nummer][9] < skills[nummer][8] && skillPunkte >= skills[nummer][10]+skills[nummer][9]) {
          if (haveRequired(nummer)) {   // sind genügend von benötigten skills geskillet
            skillPunkte -= skills[nummer][10]+skills[nummer][9];
            skills[nummer][9]++;
          }
        }
      }
      else {
        if (skills[nummer][9] > 0) {
          //prüfe ob dadurch requirements nichtmehr erfüllt sind
          skills[nummer][9]--;
          var required = true;
          for (var i = 0; i < skills.length; i++) {
            if (skills[i] != undefined && skills[i][9] > 0 && !haveRequired(i)) {
              required = false;
              break;
            }
          }
          if (required) {
            skillPunkte += skills[nummer][10]+skills[nummer][9];
          }
          else {
            skills[nummer][9]++;
          }
        }
      }
      var pos = document.getElementById("stats").getBoundingClientRect();
      saveSkillTree();
      applaySkills();
      showStats(false, pos.x-70, pos.y, document.getElementById("stats").id);
    }
    function haveRequired(nummer) {
      var required = skills[nummer][7];   // sind genügend von benötigten skills geskillet
      for (var i = 0; i < skills[nummer][6].length; i++) {
        required -= skills[skills[nummer][6][i]][9];
      }
      if (required <= 0) {
        return true;
      }
      else {
        return false;
      }
    }
    function showStats(useThis = false, x = 0, y = 0, id = "") {
      if (useThis) {
        var pos = this.getBoundingClientRect();
        x = pos.x;
        y = pos.y;
        id = this.id;
        var towerTyp = id.substr(0,2)*1;
        selected = towerTyp;
      }
      else {
        var towerTyp = selected;
      }
      document.getElementById("stats").style.top = y + 'px';
      document.getElementById("stats").style.left = x + 70 + 'px';
      document.getElementById("stats").hidden = false;
      if (towerTyp == 11) {
        document.getElementsByName("Turmname")[0].innerHTML = "Stats für alle Türme";
        document.getElementsByName("Damge")[0].innerHTML = "+" + round(Math.pow(1+skills[110][4]/100, skills[110][9])-1, 2)+"%";
        document.getElementsByName("critChance")[0].innerHTML = "+" + round(Math.pow(1+skills[114][4]/100, skills[114][9])-1, 2)+"%";
        document.getElementsByName("critDamage")[0].innerHTML = "+" + round(Math.pow(1+skills[115][4]/100, skills[115][9])-1, 2)+"%";
        document.getElementsByName("Angriffszeit")[0].innerHTML = "-" + round(1-Math.pow(1-skills[111][4]/100, skills[111][9]), 2)+"%";
        document.getElementsByName("Reichweite")[0].innerHTML = "+" + round(Math.pow(1+skills[112][4]/100, skills[112][9])-1, 2)+"%";
        document.getElementsByName("Drehgeschwindigkeit")[0].innerHTML = "+" + round(Math.pow(1+skills[113][4]/100, skills[113][9])-1, 2)+"%";
        document.getElementById('EffecktStärke').hidden = false;
        document.getElementById('EffecktDauer').hidden = false;
        document.getElementById('EffecktStärke').childNodes[1].innerHTML = "EffecktStärke +" + round(Math.pow(1+skills[116][4]/100, skills[116][9])-1, 2)+"%";
        document.getElementById('EffecktDauer').childNodes[1].innerHTML = "EffektDauer/EffecktReichweite +" + round(Math.pow(1+skills[117][4]/100, skills[117][9])-1, 2)+"%";
        document.getElementById('st5').hidden = true;
        document.getElementById('MaxStufe').hidden = false;
        document.getElementsByName('MaxStufe')[0].innerHTML = skills[123][9]+3;
      }
      else {
        document.getElementsByName("Turmname")[0].innerHTML = towertypen[towerTyp][10];
        document.getElementsByName("Damge")[0].innerHTML = round(towertypen[towerTyp][2], 2);
        document.getElementsByName("critChance")[0].innerHTML = round(towertypen[towerTyp][13], 2) + "%";
        document.getElementsByName("critDamage")[0].innerHTML = round(towertypen[towerTyp][14], 2) + "%";
        document.getElementsByName("Angriffszeit")[0].innerHTML = round(towertypen[towerTyp][5], 4) + "sec";
        document.getElementsByName("Reichweite")[0].innerHTML = round(towertypen[towerTyp][4], 2);
        document.getElementsByName("Drehgeschwindigkeit")[0].innerHTML = round(towertypen[towerTyp][3]*100, 2) + " Grad/sec";
        if (towertypen[towerTyp][7].length == 0) {
          document.getElementById('EffecktStärke').hidden = true;
          document.getElementById('EffecktDauer').hidden = true;
        }
        else {
          document.getElementById('EffecktStärke').hidden = false;
          document.getElementById('EffecktDauer').hidden = false;
          var obj = document.getElementById('EffecktStärke').childNodes[1];
          obj.innerHTML = "";
          for (var i = 0; i < towertypen[towerTyp][7].length; i++) {
            switch (towertypen[towerTyp][7][i]) {
              case 0:
                obj.innerHTML += "Verlangsamt Gegner auf die " + round(1 / (towertypen[towerTyp][8][i] + 1), 4) + " fache Geschwindigkeit <br>";
                break;
              case 1:
                obj.innerHTML += "Stunned Gegner <br>";
                break;
              case 2:
                obj.innerHTML += "Verbrennt Gegner für " + round(towertypen[towerTyp][8][i], 2) + " Schaden/sec <br>";
                break;
              case 3:
                obj.innerHTML += "Vergiftet Gegner für " + round(towertypen[towerTyp][8][i], 2) + " Schaden/sec <br>";
                break;
              case 5:
                obj.innerHTML += "Trifft nahe Gegner zusätzlich für " + round(towertypen[towerTyp][8][i], 2) + " Schaden <br>";
                break;
              case 6:
                obj.innerHTML += "Springt zusätzlich bis zu " + towertypen[towerTyp][8][i] + " mal auf nahe Gegner über <br>";
                break;
              case 7:
                obj.innerHTML += "Verbesstert den Damage von nahen Türmen um " + round(towertypen[towerTyp][8][i], 2) + "% <br>";
                break;
              case 8:
                obj.innerHTML += "Oder: Verbesstert die Angriffsgeschwindigkeit von nahen Türmen um " + round(towertypen[towerTyp][8][i], 2) + "% <br>";
                break;
              case 9:
                obj.innerHTML += "Oder: Verbesstert die Effektstärke, -dauer und -reichweite von nahen Türmen um " + round(towertypen[towerTyp][8][i], 2) + "% <br>";
                break;
              case 10:
                obj.innerHTML += "Oder: Verbesstert die Drehgeschwindigkeit und Reichweite von nahen Türmen um " + round(towertypen[towerTyp][8][i], 2) + "% <br>";
                break;
            }
          }
          obj = document.getElementById('EffecktDauer').childNodes[1];
          obj.innerHTML = "";
          if (towertypen[towerTyp][7].length > 1) {
            for (var i = 0; i < towertypen[towerTyp][7].length; i++) {
              if (towertypen[towerTyp][7][i] >= 5 && towertypen[towerTyp][7][i] <= 9) {
                obj.innerHTML += "Effektreichweite Effeckt " + (i+1) + ": " + round(towertypen[towerTyp][9][i], 2) + " <br>";
              }
              else {
                obj.innerHTML += "Effektdauer: Effeckt " + (i+1) + ": " + round(towertypen[towerTyp][9][i], 2) + "sec <br>";
              }
            }
          }
          else {
            if (towertypen[towerTyp][7][0] >= 5 && towertypen[towerTyp][7][0] <= 9) {
              obj.innerHTML += "Effektreichweite: " + round(towertypen[towerTyp][9][0], 2) + " <br>";
            }
            else {
              obj.innerHTML += "Effektdauer: " + round(towertypen[towerTyp][9][0], 2) + "sec <br>";
            }
          }
        }
        document.getElementById('st5').hidden = false;
        document.getElementById('MaxStufe').hidden = true;
        document.getElementsByName("Stufe5unlockt")[0].innerHTML = towertypen[towerTyp][12];
      }
      for (var i = 0; i < document.getElementsByName("buttons").length; i++) {
        if (i == 9) {
          var nummer = 123;
        }
        else {
          var nummer = i + 10 * selected;
        }
        if (skills[nummer] == undefined) {
          document.getElementsByName("buttons")[i].hidden = true;
        }
        else {
          document.getElementsByName("buttons")[i].hidden = false;
          if (skills[nummer][9] < skills[nummer][8] && skillPunkte >= skills[nummer][10]+skills[nummer][9] && haveRequired(nummer)) {
            document.getElementsByName("plus")[i].src = "Bilder/icons/plusAn.png";
          }
          else {
            document.getElementsByName("plus")[i].src = "Bilder/icons/plusAus.png";
          }
          if (skills[nummer][9] > 0) {
            skills[nummer][9]--;
            required = true;
            for (var j = 0; j < skills.length; j++) {
              if (skills[j] != undefined && skills[j][9] > 0 && !haveRequired(j)) {
                required = false;
                break;
              }
            }
            skills[nummer][9]++;
            if (required) {
              document.getElementsByName("minus")[i].src = "Bilder/icons/minusAn.png";
            }
            else {
              document.getElementsByName("minus")[i].src = "Bilder/icons/minusAus.png";
            }
          }
          else {
            document.getElementsByName("minus")[i].src = "Bilder/icons/minusAus.png";
          }
        }
      }
    }
    </script>
  </body>
</html>
